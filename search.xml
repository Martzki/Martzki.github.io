<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2022/01/31/Hello-World/</url>
    <content><![CDATA[<h1 id="About-Hello-World"><a href="#About-Hello-World" class="headerlink" title="About Hello World"></a>About Hello World</h1><ul>
<li>Hello Worldå¾€å¾€ä½œä¸ºå¾ˆå¤šé¡¹ç›®çš„åˆå§‹ç¤ºä¾‹ç¨‹åºï¼Œæˆ‘ä¸ªäººæŠŠHello Worldè§†ä¸ºç¨‹åºå‘˜å¯¹å¾…â€œæœ€åˆâ€çš„å“²å­¦ï¼Œæ‰€ä»¥æŠŠå®ƒä½œä¸ºè¿™ä¸ªåšå®¢çš„ç¬¬ä¸€ç¯‡åšæ–‡çš„æ ‡é¢˜ï¼Œç”¨äºç»™è¿™ä¸ªåšå®¢å¼€ä¸ªå¤´ï¼ˆç»ˆäºèµ¶åœ¨è¿‡å¹´å‰å†™å‡ºæ¥äº†ï¼‰ã€‚<span id="more"></span></li>
</ul>
<h1 id="About-Lost-Stars"><a href="#About-Lost-Stars" class="headerlink" title="About Lost Stars"></a>About Lost Stars</h1><ul>
<li>Lost Starsæ˜¯æˆ‘ä¸ªäººæœ€å–œæ¬¢çš„Maroon 5çš„ä¸€é¦–æ­Œï¼Œæ­Œè¯ä¸­è¡¨ç°äº†å’Œâ€œå¯„èœ‰è£äºå¤©åœ°ï¼Œæ¸ºæ²§æµ·ä¹‹ä¸€ç²Ÿâ€æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™çš„å¯¹ä¸ªä½“çš„æ¸ºå°ä¹‹æ„Ÿå¹ï¼Œå’Œæˆ‘ä¸ªäººç›®å‰çš„äººç”ŸçŠ¶æ€è¾ƒä¸ºå¥‘åˆï¼Œæ‰€ä»¥æŠŠå®ƒä½œä¸ºè¿™ä¸ªåšå®¢çš„æ ‡é¢˜ï¼›</li>
<li>åç»­åº”è¯¥ä¸»è¦ä¼šå‘å¸ƒä¸€äº›æŠ€æœ¯ç›¸å…³çš„ä¸»é¢˜ï¼Œä¸»è¦æ˜¯ä½œä¸ºè‡ªå·±çš„æŠ€æœ¯ç§¯ç´¯å’Œæ€»ç»“ï¼Œæ­¤å¤–åº”è¯¥ä¹Ÿä¼šæ›´æ–°ä¸€äº›ä¸ªäººçš„æ¸¸è®°ï¼›</li>
<li>ä½ å¯èƒ½æ˜¯ä»æˆ‘çš„ç®€å†æˆ–è€…æˆ‘çš„Githubä¸»é¡µæ¥åˆ°è¿™ä¸ªåšå®¢ï¼Œè¯·ä¸»è¦å…³æ³¨æŠ€æœ¯ç›¸å…³çš„å†…å®¹ğŸ™ƒï¼›</li>
<li>ä¸»é¡µå›¾ç‰‡ä½¿ç”¨äº†ä¹‹å‰ä»Bingé¦–é¡µä¿å­˜ä¸‹æ¥çš„ä¸œäº¬å¡”çš„ç…§ç‰‡ï¼Œæˆ‘ä¸ªäººå¾ˆå–œæ¬¢ï¼Œå¦‚æœ‰ä¾µæƒè¿˜è¯·è”ç³»æˆ‘ï¼›</li>
<li>åšå®¢åŸºäº<a href="https://hexo.io/zh-cn/">hexo</a>æ„å»ºï¼Œä½¿ç”¨äº†<a href="https://github.com/Shen-Yu/hexo-theme-ayer">ayerä¸»é¢˜</a>ï¼Œæ„Ÿè°¢è¿™ä¸¤ä¸ªå¼€æºé¡¹ç›®ï¼›</li>
<li>äººç”Ÿä¸æ˜“ï¼Œéšç¼˜æ›´æ–°ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Other</category>
      </categories>
      <tags>
        <tag>Other</tag>
      </tags>
  </entry>
  <entry>
    <title>About Me</title>
    <url>/2022/01/09/About-Me/</url>
    <content><![CDATA[<blockquote>
<p>God, tell us the reason youth is wasted on the young.</p>
</blockquote>
<p>A coder mainly work on network virtualization dataplane development.<br>Email: <a href="mailto:&#109;&#97;&#x72;&#115;&#49;&#52;&#x38;&#x35;&#x30;&#64;&#103;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#99;&#111;&#x6d;">&#109;&#97;&#x72;&#115;&#49;&#52;&#x38;&#x35;&#x30;&#64;&#103;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#99;&#111;&#x6d;</a></p>
<img src="/images/avatar.JPG" width="40%" height="40%">]]></content>
      <categories>
        <category>Other</category>
      </categories>
      <tags>
        <tag>Other</tag>
      </tags>
  </entry>
  <entry>
    <title>Some attempts to connect to VDI</title>
    <url>/2022/02/06/Some-attempts-to-connect-to-VDI/</url>
    <content><![CDATA[<h1 id="Why-do-I-need-to-do-this"><a href="#Why-do-I-need-to-do-this" class="headerlink" title="Why do I need to do this"></a>Why do I need to do this</h1><p>å…¬å¸æä¾›VDIä½œä¸ºåŠå…¬ç¯å¢ƒï¼Œè¿œç¨‹åŠå…¬æ—¶ï¼Œéœ€è¦é€šè¿‡VPNå…ˆè¿æ¥åˆ°å…¬å¸å†…ç½‘ï¼Œå†ä»å†…ç½‘è¿æ¥åˆ°åŠå…¬VDIã€‚<br>å…¬å¸æä¾›äº†Macå’ŒWindowsçš„VPNå®¢æˆ·ç«¯ç”¨äºè¿æ¥åˆ°å†…ç½‘ï¼ŒæŒ‰ç†è¯´å®‰è£…å¹¶ä½¿ç”¨å…¬å¸æä¾›çš„å®¢æˆ·ç«¯è¿æ¥å†…ç½‘å³å¯ï¼Œä½†æ˜¯ä¹‹æ‰€ä»¥æ²¡æœ‰è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªä¸»è¦åŸå› ï¼š    </p>
<ul>
<li>å…¬å¸æä¾›çš„VPNé…å¥—çš„è½¯ä»¶å¤ªè¿‡è‡ƒè‚¿ï¼›</li>
<li>å…¬å¸æä¾›çš„VDIå†…ç½®äº†è®¿é—®æ§åˆ¶è½¯ä»¶ï¼Œä¼šè®°å½•IMçš„èŠå¤©è®°å½•ç­‰ä¿¡æ¯ã€‚æ‹…å¿ƒVPNâ€œé™„èµ â€çš„è½¯ä»¶æˆ–è€…VPNæœ¬èº«ä¼šåšç±»ä¼¼çš„æ“ä½œğŸ™„ã€‚</li>
</ul>
<p>è¿™ç¯‡åšæ–‡ä¸»è¦è®°å½•ä¸‹æŠ˜è…¾è™šæ‹Ÿæ¡Œé¢ç¯å¢ƒçš„ä¸€äº›ç»å†ã€‚</p>
<span id="more"></span>

<h1 id="What-attempts-did-I-try"><a href="#What-attempts-did-I-try" class="headerlink" title="What attempts did I try"></a>What attempts did I try</h1><p>ç”±äºä¸Šé¢è¯´çš„åŸå› ï¼Œéœ€è¦åœ¨ä¸ªäººPCç¯å¢ƒä¹‹å¤–ï¼Œæä¾›ä¸€ä¸ªæ¡Œé¢ç¯å¢ƒç”¨äºè¿œç¨‹è¿æ¥åˆ°VDIã€‚<br>å†å»é…ç½®ä¸€å¥—ç‰©ç†æ¡Œé¢ç¯å¢ƒæ˜¾ç„¶æ˜¯ä¸ç°å®çš„ï¼Œæ‰€ä»¥ä¸»è¦å‘è™šæ‹Ÿæ¡Œé¢ç¯å¢ƒè€ƒè™‘ï¼š</p>
<ul>
<li>Windows Sandbox</li>
<li>Cloud Virtual Mechine</li>
<li>Reverse Proxy (frp)</li>
<li>MacOS Container</li>
</ul>
<h2 id="Windows-Sandbox"><a href="#Windows-Sandbox" class="headerlink" title="Windows Sandbox"></a>Windows Sandbox</h2><p><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-sandbox/windows-sandbox-overview">Windows Sandbox</a>æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ï¼Œå®ƒæ˜¯Windowså†…ç½®çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåœ¨Windows 10çš„ä¸“ä¸š/ä¼ä¸šç‰ˆä¸­æ‰“å¼€é€‰é¡¹åå¯ä»¥ç›´æ¥å¯åŠ¨ã€‚<br>è¯¥æŠ€æœ¯å’Œé€šç”¨çš„è™šæ‹ŸåŒ–æŠ€æœ¯ä¸€æ ·ï¼Œå¯¹CPUçš„è™šæ‹ŸåŒ–ç‰¹æ€§ä¹Ÿæœ‰ä¸€å®šè¦æ±‚ï¼Œä¸è¿‡ä¸æ˜¯å¤ªè€çš„CPUåº”è¯¥éƒ½èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ã€‚åœ¨æˆ‘ä¸ªäººçš„ç§»åŠ¨ç«¯4ä»£i7ã€8Gå†…å­˜çš„PCä¸Šï¼ŒWindows 10å’ŒWindows 11ä¸­ï¼ŒWindows Sandboxéƒ½æœ‰è¶³å¤Ÿå¥½çš„è¡¨ç°ã€‚å› ä¸ºå®ƒåªæ˜¯è™šæ‹Ÿäº†ä¸€å¥—è¿è¡Œç¯å¢ƒï¼ˆruntime environmentï¼‰ï¼Œåº”è¯¥æ˜¯WIndowsè‡ªå·±çš„å®¹å™¨åŒ–æŠ€æœ¯ã€‚ç›¸æ¯”äºç›´æ¥è¿è¡Œä¸€ä¸ªè™šæ‹Ÿæœºè€Œè¨€ï¼Œè½»é‡çš„å¤šï¼ŒåŒæ—¶å®ƒè¿˜æ”¯æŒGPUè™šæ‹ŸåŒ–ï¼Œä»å®é™…ä½¿ç”¨ä½“éªŒä¸Šæ¥çœ‹ï¼ŒSandboxçš„å¯åœéƒ½è¶³å¤Ÿå¿«ï¼ŒåŒæ—¶å›¾å½¢æ€§èƒ½å¯¹äºåŸºæœ¬åŠå…¬è¶³å¤Ÿä½¿ç”¨äº†ã€‚<br>ä½†å®ƒæœ‰ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼šæ‰€æœ‰åœ¨Sandboxä¸­æ‰€åšä¿®æ”¹éƒ½ä¸ä¼šè¢«ä¿å­˜ï¼Œå°†ä¼šéšSandboxè¿›ç¨‹çš„é€€å‡ºä¸€å¹¶è¢«é”€æ¯ï¼ˆç±»ä¼¼äºåŠ äº†<code>--rm</code>å‚æ•°çš„dockerå®¹å™¨ğŸ¤¨ï¼‰ã€‚è¿™ä¸ªç‰¹æ€§æä¾›äº†ç»å¯¹çš„Sandboxç¯å¢ƒï¼Œä½†å’Œæˆ‘ä¸ªäººçš„ä½¿ç”¨åœºæ™¯ä¸Šå¹¶ä¸æ˜¯å®Œå…¨å¥‘åˆï¼Œæ¯æ¬¡éœ€è¦è¿æ¥VDIæ—¶éƒ½è¦å…¨æ–°å®‰è£…ä¸€æ•´å¥—çš„VPNè½¯ä»¶ï¼Œä¸è¿‡æ€»ä½“æ¥è¯´ä»ä½¿ç”¨éš¾åº¦å’Œä½¿ç”¨ä½“éªŒä¸Šæ¥è¯´ï¼Œè¿˜æ˜¯ç›¸å¯¹ä¸é”™çš„ã€‚<br>æ²¡æœ‰æœ€ç»ˆä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆçš„åŸå› ä¸»è¦æ˜¯å› ä¸ºæˆ‘çš„Windows PCåäº†ğŸ˜…ã€‚</p>
<h2 id="Cloud-Virtual-Mechine"><a href="#Cloud-Virtual-Mechine" class="headerlink" title="Cloud Virtual Mechine"></a>Cloud Virtual Mechine</h2><p>Windows PCåäº†ä»¥åï¼Œå¼€å§‹è½¬æˆ˜MacOSã€‚è™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªå¸¸è§çš„èƒ½å¤Ÿæä¾›è™šæ‹Ÿæ¡Œé¢ç¯å¢ƒçš„æ–¹å¼ï¼Œç”±äºMacOSçš„è½¯ä»¶ç”Ÿæ€ï¼ˆä¸»è¦æ˜¯ğŸ’°çš„é—®é¢˜ï¼‰ï¼Œæ²¡æœ‰é€‰æ‹©ç›´æ¥åœ¨MacOSä¸Šè¿è¡Œè™šæ‹Ÿæœºï¼Œè½¬è€Œè€ƒè™‘å…¬æœ‰äº‘æä¾›çš„è™šæ‹ŸæœºæœåŠ¡ï¼Œæ­£å¥½çœ‹åˆ°è…¾è®¯äº‘æœ‰è½»é‡åº”ç”¨æœåŠ¡å™¨çš„ä¼˜æƒ ï¼Œä¸”æ”¯æŒWindowsç³»ç»Ÿï¼Œé‚é©¬ä¸Šä¸‹å•ã€‚<br>ä½†å½“çœŸæ­£ä½¿ç”¨è¿™ä¸ªè™šæ‹Ÿæœºæ—¶å‘ç°ï¼Œå…¬å¸æä¾›çš„VPNå®¢æˆ·ç«¯ä¸æ”¯æŒåœ¨Windows Serverå®‰è£…ï¼ˆåƒåœ¾ğŸ™ƒï¼‰ï¼ŒåŒæ—¶è¿™ä¸ªè½»é‡åº”ç”¨æœåŠ¡å™¨ä¸æ”¯æŒè‡ªè¡Œä¸Šä¼ é•œåƒå®‰è£…ç³»ç»Ÿï¼Œæ‰€ä»¥æ²¡æ³•ç›´æ¥é‡è£…æˆä¸ªäººç‰ˆçš„Windowsã€‚<br>ä½†ï¼Œä¹°éƒ½ä¹°äº†ï¼Œè¿˜æ˜¯æŠ˜è…¾ä¸‹å§ã€‚</p>
<h3 id="Nested-Virtualization"><a href="#Nested-Virtualization" class="headerlink" title="Nested Virtualization"></a>Nested Virtualization</h3><p>ç¬¬ä¸€ä¸ªå°è¯•æ˜¯è™šæ‹Ÿæœºï¼Œæ²¡é”™ï¼Œæ˜¯åœ¨1æ ¸2Gçš„è™šæ‹Ÿæœºä¸Šå†è·‘ä¸€ä¸ªWindowsè™šæ‹Ÿæœºã€‚<br>åŸºäºå¦‚æ­¤æ‹‰èƒ¯çš„ç¡¬ä»¶é…ç½®ï¼ŒHostå¿…ä¸å¯èƒ½é€‰Windowsäº†ï¼Œæ‰€ä»¥é‡è£…æˆäº†CentOSã€‚ç„¶åå°±æ˜¯supervisorçš„é€‰æ‹©ï¼Œå·¥ä½œä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯QEMU-KVMï¼Œç›¸å¯¹æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œæ‰€ä»¥å°è¯•æ¢ç”¨Virutal Boxã€‚<br>è™½ç„¶<a href="https://www.virtualbox.org/">Virutal Box</a>æ˜¯Oracleä¸»å¯¼çš„å¼€æºé¡¹ç›®ï¼Œä½†å®˜ç½‘å°±ç»™äººä¸€ç§è´«ç©·çš„æ„Ÿè§‰ã€‚å®ƒä¸»è¦è¿è¡Œåœ¨æ¡Œé¢ç¯å¢ƒä¸Šï¼Œè™½ç„¶æä¾›äº†å‘½ä»¤è¡Œå·¥å…·VBoxManageï¼Œä½†åœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸‹ä»ç„¶éœ€è¦å®‰è£…ä¸€äº›å¦‚QTç›¸å…³çš„ä¾èµ–åº“ã€‚ä¸å¹¸çš„æ˜¯åœ¨è§£å†³äº†ä¾èµ–é—®é¢˜ï¼Œé…ç½®å¥½è™šæ‹Ÿæœºåï¼Œä»ç„¶æ— æ³•å¯åŠ¨ï¼ŒæŠ¥é”™æ˜¯æ— æ³•å¯ç”¨ç¡¬ä»¶åŠ é€Ÿç‰¹æ€§ï¼ˆè…¾è®¯äº‘çš„è¿™ä¸ªè™šæ‹Ÿæœºä¸æ”¯æŒåµŒå¥—è™šæ‹ŸåŒ–ï¼‰ï¼Œåœ¨é…ç½®é‡Œå–æ¶ˆäº†æ‰€æœ‰ç¡¬ä»¶åŠ é€Ÿçš„é€‰é¡¹åï¼Œè¿˜æ˜¯æ— æ³•è§£å†³è¯¥é—®é¢˜ï¼ˆMacOSä¸Šçš„Virtual Boxä¹Ÿæ˜¯ä¸€å †BUGï¼‰ï¼Œæ— å¥ˆåªèƒ½æ”¾å¼ƒVirtual Boxã€‚<br>äºæ˜¯æ¢ç”¨QEMUï¼Œç›´æ¥ä½¿ç”¨yumå®‰è£…ï¼Œä½¿ç”¨libvirtè¿›è¡Œè™šæ‹Ÿæœºé…ç½®ï¼Œç”±äºä¸æ”¯æŒåµŒå¥—è™šæ‹ŸåŒ–ï¼ŒåŒæ ·æ²¡æ³•ä½¿ç”¨QEMU-KVMï¼Œåªèƒ½é€šè¿‡çº¯æ¨¡æ‹Ÿçš„CPUè¿è¡ŒGuestOSï¼Œè™½ç„¶èƒ½å¤Ÿè¿è¡Œï¼Œä½†æ˜¯å‡ ä¹å®Œå…¨æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œå¼€æœºéœ€è¦15minï¼Œå¼€æœºä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œå°±æ˜¯æŠ˜è…¾æ¥ç©ç©ç½¢äº†ã€‚</p>
<h3 id="Dual-Operation-System"><a href="#Dual-Operation-System" class="headerlink" title="Dual Operation System"></a>Dual Operation System</h3><p>è¿™ä¸ªé…ç½®ä¸‹çš„åµŒå¥—è™šæ‹ŸåŒ–ä¹Ÿå°±å›¾ä¸€ä¹ï¼Œæ—¢ç„¶å®˜æ–¹ç»™çš„é•œåƒä¸åŒ…å«ä¸ªäººç‰ˆçš„Windowsï¼ŒåŒæ—¶ä¹Ÿä¸æ”¯æŒè‡ªå®šä¹‰ä¸Šä¼ é•œåƒï¼Œé‚£å°±é‡‡ç”¨å®‰è£…åŒç³»ç»Ÿçš„æ›²çº¿æ•‘å›½çš„æ–¹å¼ã€‚<br>å…ˆä½¿ç”¨åŸæœ‰åˆ†åŒºçš„ç©ºé—²ç©ºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†åŒºï¼Œå†å°†æ“ä½œç³»ç»Ÿé•œåƒä¸‹è½½åˆ°ç¡¬ç›˜ä¸Šï¼Œç›´æ¥ä»ç¡¬ç›˜è¿è¡Œå®‰è£…ç¨‹åºï¼Œå°†æ“ä½œç³»ç»Ÿå®‰è£…åˆ°æ–°çš„åˆ†åŒºä¸Šã€‚<br>ä¸ºäº†åœ¨1æ ¸2Gçš„æ‹‰èƒ¯é…ç½®ä¸Šå°½å¯èƒ½æµç•…åœ°è¿è¡ŒWindowsï¼Œä½¿ç”¨<a href="https://archive.org/details/Tiny7">Tiny7</a>ï¼ˆç²¾ç®€ç‰ˆçš„Windows 7ï¼‰ä½œä¸ºä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œä½†é•œåƒå†…ä¸åŒ…å«Virtioé©±åŠ¨ï¼Œæ— æ³•ç»§ç»­å®‰è£…ã€‚ä¸‹è½½äº†å‡ ä¹æ‰€æœ‰ç‰ˆæœ¬çš„Virtioé©±åŠ¨åœ¨å®‰è£…æ—¶ä½¿ç”¨ï¼Œä½†å…¨éƒ½æ— æ³•å¥æ•ˆï¼Œæœ€åæ— å¥ˆæ¢ç”¨äº†<a href="https://archive.org/details/tiny-10_202105">Tiny10</a>ï¼ˆç²¾ç®€ç‰ˆçš„Windows 10ï¼‰ã€‚ä½¿ç”¨Tiny10åï¼Œåœ¨å®‰è£…æ—¶é€‰æ‹©ç¡¬ç›˜ä¸Šå·²æœ‰çš„Virtioé©±åŠ¨ï¼Œå³å¯å®Œæˆæ­£å¸¸å®‰è£…ã€‚<br>æµç•…åº¦ä¸Šæ¥è¯´å’Œè‡ªå¸¦çš„Windows Serverç›¸æ¯”æ²¡æœ‰æ˜æ˜¾å·®è·ï¼Œåœ¨è¿œç¨‹è¿æ¥ä¸ŠVDIåï¼Œç”±äºè‡ªèº«é…ç½®æ‹‰èƒ¯ï¼Œæµç•…åº¦ä¸€èˆ¬ã€‚ä¸”ç”±äºæ²¡æœ‰æ˜¾å¡ï¼Œåœ¨éœ€è¦å›¾å½¢æ¸²æŸ“çš„åœºæ™¯ä¸‹ï¼ˆå¦‚çª—å£åˆ‡æ¢ï¼‰ï¼Œå¡é¡¿æ˜æ˜¾ã€‚æ€»çš„æ¥è¯´å±äºå‹‰å¼ºå¯ç”¨çš„ç¨‹åº¦ï¼Œä½†å¥½å¤„æ˜¯æ— éœ€åœ¨è‡ªå·±çš„PCä¸Šè¿è¡Œè™šæ‹Ÿæœºã€‚  </p>
<h3 id="Windows-Container"><a href="#Windows-Container" class="headerlink" title="Windows Container"></a>Windows Container</h3><p><a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/">Windows Container</a>æ˜¯è€ƒè™‘è¿‡çš„å¦ä¸€ä¸ªæŠ˜è…¾æ–¹å‘ï¼ŒWindowså®˜æ–¹æä¾›äº†<a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/container-base-images">é•œåƒ</a>ï¼Œä½†åœ¨Windows Serverå®‰è£…Dockeræ—¶ï¼Œå§‹ç»ˆæœ‰é—®é¢˜æ— æ³•è§£å†³ï¼ŒåŒæ—¶Windowså®¹å™¨åªèƒ½ä½¿ç”¨å’ŒHostç›¸åŒçš„kernelï¼Œå¹¶ä¸”æ— æ³•æä¾›ä¸€ä¸ªåŸºäºå®¹å™¨çš„æ¡Œé¢ç¯å¢ƒï¼Œé‚æ”¾å¼ƒã€‚</p>
<h2 id="Reverse-Proxy-frp"><a href="#Reverse-Proxy-frp" class="headerlink" title="Reverse Proxy (frp)"></a>Reverse Proxy (frp)</h2><p>ä½¿ç”¨åå‘ä»£ç†ï¼ˆå¦‚<a href="https://github.com/fatedier/frp">frp</a>ï¼‰å°†Windowsè¿œç¨‹æ§åˆ¶æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œæ–¹æ¡ˆï¼Œä½†ç»†èŠ‚ä¸Šæ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚<br>ç”±äºåŠå…¬VDIæ˜¯å’Œå…¬ç½‘éš”ç¦»çš„ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥ä½¿ç”¨åå‘ä»£ç†ç›´æ¥è¿æ¥åˆ°åŠå…¬VDIã€‚ä½†å…¬å¸æä¾›äº†å¤–ç½‘VDIç”¨äºåœ¨åŠå…¬æ—¶è®¿é—®å…¬ç½‘ï¼Œå¯ä»¥ä½¿ç”¨åå‘ä»£ç†è¿æ¥åˆ°å¤–ç½‘VDIï¼Œå†åœ¨å¤–ç½‘VDIä¸­å®‰è£…è¿è¡ŒVPNå®¢æˆ·ç«¯ååå‘è¿æ¥åˆ°åŠå…¬VDIå†…ã€‚<br>è¿™ç§æ–¹æ¡ˆä¸‹çš„å¤–ç½‘VDIä»£æ›¿äº†è‡ªè´­çš„å…¬æœ‰äº‘è™šæ‹Ÿæœºï¼Œæ‹¥æœ‰æ›´é«˜çš„é…ç½®ï¼Œä½†åŒæ ·ä¸æ”¯æŒè™šæ‹Ÿæ˜¾å¡ï¼Œå›¾å½¢æ€§èƒ½ä»ç„¶æ‹‰èƒ¯ã€‚æŒ‰ç†è¯´å¯ä»¥æ›¿ä»£è‡ªè´­çš„å…¬æœ‰äº‘è™šæ‹Ÿæœºäº†ï¼Œä½†ç”±äºå®‰å…¨éƒ¨é—¨å®¡è®¡åˆ°frpæµé‡ï¼Œå‘ŠçŸ¥ä¸å…è®¸ä½¿ç”¨æ­¤ç±»åå‘ä»£ç†ï¼Œé‚æ”¾å¼ƒã€‚  </p>
<h2 id="MacOS-Container"><a href="#MacOS-Container" class="headerlink" title="MacOS Container"></a>MacOS Container</h2><p>åœ¨è€ƒè™‘è™šæ‹ŸåŒ–æ–¹æ¡ˆæ—¶ï¼Œè§‰å¾—è™šæ‹Ÿæœºæ¶ˆè€—è¿‡å¤§åï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯å®¹å™¨æŠ€æœ¯ã€‚å¦‚æœä½¿ç”¨å®¹å™¨æŠ€æœ¯èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œé‚£å°±èƒ½å¤Ÿä½¿ç”¨ä¸€ä¸ªè½»é‡åŒ–çš„éš”ç¦»ç¯å¢ƒã€‚åœ¨æˆ‘åªæœ‰MacOSçš„å‰æä¸‹ï¼Œå¼€å§‹æŸ¥æ‰¾æ˜¯å¦æœ‰MacOSçš„å®¹å™¨åŒ–æ–¹æ¡ˆã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œè¿˜çœŸæœ‰ä¸ªé¡¹ç›®<a href="https://github.com/sickcodes/Docker-OSX">Docker-OSX</a>ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®åŸºäºQEMU-KVMï¼Œè¯´ç™½äº†è¿˜æ˜¯è™šæ‹Ÿæœºé‚£ä¸€å¥—ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯çœ‹äº†çœ‹è€Œå·²ã€‚</p>
<h1 id="What-did-I-chose-finally"><a href="#What-did-I-chose-finally" class="headerlink" title="What did I chose finally"></a>What did I chose finally</h1><p>ç”±äºä¸Šè¿°ç§ç§åŸå› ï¼Œæœ€ç»ˆçš„ä½¿ç”¨æ–¹æ¡ˆæ˜¯åœ¨å…¬æœ‰äº‘è‡ªè´­çš„è™šæ‹Ÿæœºä¸Šå®‰è£…çš„åŒç³»ç»Ÿä¸­ï¼Œè¿æ¥åˆ°è¿œç¨‹VDIã€‚<br>å¦‚æœæœ‰Windowsç¯å¢ƒçš„è¯ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨WIndows Sandboxï¼›MacOSç¯å¢ƒä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿå®¹å¿è™šæ‹Ÿæœºçš„æ€§èƒ½æ¶ˆè€—çš„è¯ï¼Œè™šæ‹Ÿæœºåº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚<br>ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å…¬æœ‰äº‘ä¸Šçš„æ‹‰èƒ¯è™šæ‹Ÿæœºä¸­è¿æ¥åˆ°è¿œç¨‹VDIçš„æ–¹æ¡ˆå¹¶ä¸æ˜¯ä»€ä¹ˆç†æƒ³æ–¹æ¡ˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>Virtualization</tag>
      </tags>
  </entry>
  <entry>
    <title>Virtio feature negotiation from QEMU perspective</title>
    <url>/2022/02/06/Virtio-feature-negotiation-from-QEMU-perspective/</url>
    <content><![CDATA[<h1 id="QEMUä¸­çš„Virtio-featuresåå•†æµç¨‹"><a href="#QEMUä¸­çš„Virtio-featuresåå•†æµç¨‹" class="headerlink" title="QEMUä¸­çš„Virtio featuresåå•†æµç¨‹"></a>QEMUä¸­çš„Virtio featuresåå•†æµç¨‹</h1><p>ä¸‹é¢ä»¥virtio-netå¯¹æ¥vhost-netï¼ˆkernelï¼‰ä¸ºä¾‹ï¼Œåˆ†ææ•´ä¸ªVirtio featuresåå•†çš„è¿‡ç¨‹ã€‚</p>
<h2 id="vhost-net"><a href="#vhost-net" class="headerlink" title="vhost-net"></a>vhost-net</h2><p>vhost_netä½œä¸ºæè¿°åç«¯çš„æ•°æ®ç»“æ„ï¼Œä¸çœŸæ­£ä½¿ç”¨çš„åç«¯ï¼ˆvhost_user or vhost_netï¼‰å¯¹åº”ã€‚<br>æ¯ä¸ªvhost_netåŒ…å«ä¸€ä¸ªvhost_devï¼Œvhost_netçš„featureså®é™…å°±æ˜¯vhost_devçš„featuresï¼Œä¸featuresç›¸å…³çš„æˆå‘˜æœ‰ï¼š<code>features</code>ï¼Œ<code>acked_features</code>ï¼Œ<code>backend_features</code>å’Œ<code>protocol_features</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vhost_net</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vhost_dev</span> <span class="title">dev</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vhost_virtqueue</span> <span class="title">vqs</span>[2];</span></span><br><span class="line">    <span class="keyword">int</span> backend;</span><br><span class="line">    NetClientState *nc;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vhost_dev</span> &#123;</span></span><br><span class="line">â€¦â€¦</span><br><span class="line">    <span class="keyword">uint64_t</span> features;</span><br><span class="line">    <span class="keyword">uint64_t</span> acked_features;</span><br><span class="line">    <span class="keyword">uint64_t</span> backend_features;</span><br><span class="line">    <span class="keyword">uint64_t</span> protocol_features;</span><br><span class="line">â€¦â€¦</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h3 id="vhost-dev-features"><a href="#vhost-dev-features" class="headerlink" title="vhost_dev::features"></a>vhost_dev::features</h3><p>åœ¨<code>vhost_dev_init</code>ä¸­ï¼Œé€šè¿‡åç«¯å¯¹åº”çš„æ¥å£ï¼ˆioctl or unix socketï¼‰ï¼Œä»åç«¯è·å–åˆ°çš„åç«¯æ”¯æŒçš„featuresã€‚</p>
<h3 id="vhost-dev-acked-features"><a href="#vhost-dev-acked-features" class="headerlink" title="vhost_dev::acked_features"></a>vhost_dev::acked_features</h3><p>å‰ç«¯ä¾æ®ä»åç«¯è·å–çš„host featuresè¿›è¡Œåå•†ï¼Œåå•†å®ŒæˆåçœŸæ­£å‘åç«¯ä¼ é€’çš„featuresï¼ˆè¿‡æ»¤äº†åç«¯ä¸æ”¯æŒçš„featuresï¼‰ï¼Œå³åç«¯çœŸæ­£å·¥ä½œçš„featuresã€‚</p>
<h3 id="vhost-dev-backend-features"><a href="#vhost-dev-backend-features" class="headerlink" title="vhost_dev::backend_features"></a>vhost_dev::backend_features</h3><p>ä»å‘½åçœ‹æ˜¯æè¿°åç«¯çš„featuresï¼Œä½†å’Œfeatureså­—æ®µé‡å¤ã€‚vhost-netç›¸å…³çš„å®é™…ä»£ç è°ƒç”¨å¦‚ä¸‹ï¼š</p>
<ol>
<li>vhost_net_ack_features: åœ¨è®¾ç½®acked_featuresä¹‹å‰ï¼Œç”¨backend_featuresçš„å€¼ä¸ºacked_featuresåˆå§‹åŒ–ã€‚è¿™é‡Œacked_featuresä¸ºä½•ä¸åˆå§‹åŒ–ä¸º0ï¼Œä»QEMUå¼€å‘è€…çš„é‚®ä»¶è®¨è®ºçœ‹ï¼Œä¹‹å‰åœ¨åˆå§‹åŒ–0æ—¶ï¼Œacked_featuresåœ¨åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè¢«åˆå§‹åŒ–ä¸ºunexpected valueï¼ˆThis will result an unexpected value of acked_features which may fail the features setting of vhost.ï¼‰ã€‚ä¸è¿‡åˆå§‹åŒ–ä¸ºbackend_featuresä¼¼ä¹åœ¨vdpaçš„åœºæ™¯ä¸‹æœ‰æ–°çš„é—®é¢˜ï¼Œä¸”é—®é¢˜ä»ç„¶openä¸­ï¼›<a href="https://bugs.launchpad.net/qemu/+bug/1924603">^1</a></li>
<li>vhost_net_init: åœ¨åç«¯ä¸ºvhost-netçš„æ¡ä»¶ä¸‹ï¼Œå¦‚æœåç«¯å¯¹åº”çš„tapè®¾å¤‡ä¸æ”¯æŒvnet_hdrï¼Œåˆ™backend_featuresä¸­çš„<code>VHOST_NET_F_VIRTIO_NET_HDR</code>è¢«ç½®ä½ï¼Œå¦åˆ™ä¸º0ï¼›</li>
<li>vhost_user_backend_init: åœ¨åç«¯ä¸ºvhost-userçš„æ¡ä»¶ä¸‹ï¼Œå¦‚æœåç«¯æ”¯æŒ<code>VHOST_USER_F_PROTOCOL_FEATURES</code>ï¼Œåˆ™backend_featuresä¸­çš„<code>VHOST_USER_F_PROTOCOL_FEATURES</code>è¢«ç½®ä½ã€‚</li>
</ol>
<p>æ­¤å¤–ï¼Œå†…æ ¸vhostä»£ç ä¸­å®šä¹‰äº†<code>VHOST_NET_BACKEND_FEATURES</code>ï¼Œå¯¹åº”çš„ioctlæ“ä½œä¸º<code>VHOST_GET_BACKEND_FEATURES</code>å’Œ<code>VHOST_SET_BACKEND_FEATURES</code>ï¼Œä¸è¿‡ç›®å‰QEMUä»£ç ä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªioctlæ“ä½œå¯¹åº”çš„é€»è¾‘ã€‚</p>
<h3 id="vhost-dev-protocol-features"><a href="#vhost-dev-protocol-features" class="headerlink" title="vhost_dev::protocol_features"></a>vhost_dev::protocol_features</h3><p>åè®®çš„æ‰©å±•featuresã€‚ä¸ºäº†ä¿æŒå‘ä¸‹å…¼å®¹æ€§ï¼Œvhost-useråè®®æ–°å¢çš„featuresä½¿ç”¨protocol_featuresè¿›è¡Œæè¿°ï¼Œç”±<code>VHOST_USER_F_PROTOCOL_FEATURES</code>è¿›è¡Œæ§åˆ¶ï¼Œæ ‡è¯†protocol_featuresæ˜¯å¦ä½¿ç”¨ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VHOST_USER_F_PROTOCOL_FEATURES 30</span></span><br></pre></td></tr></table></figure>
<p>åœ¨vhost-netåœºæ™¯ä¸‹ï¼Œprotocol_featuresè¢«è®¾ç½®ä¸º0ã€‚</p>
<h2 id="virtio-net"><a href="#virtio-net" class="headerlink" title="virtio-net"></a>virtio-net</h2><p>virtio-netä½œä¸ºæè¿°åç«¯çš„æ•°æ®ç»“æ„ï¼Œä¸Guestçš„å‰ç«¯é©±åŠ¨ï¼ˆvirtio_netï¼‰å¯¹åº”ã€‚åœ¨QEMUä¸­ï¼Œç”¨VirtIONetæ¥æè¿°virtio-netï¼Œæ¯ä¸ªVirtIONetç»“æ„ä¸­åŒ…å«äº†å…¶å¯¹åº”çš„VirtIODeviceã€‚å…¶ä¸­ä¸featuresæœ‰å…³çš„æˆå‘˜æœ‰ï¼šVirtIONetçš„<code>host_features</code>ï¼ŒVirtIODeviceçš„<code>guest_features</code>ï¼Œ<code>host_features</code>å’Œ<code>backend_features</code>ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VirtIONet</span> &#123;</span></span><br><span class="line">    VirtIODevice parent_obj;</span><br><span class="line">â€¦â€¦</span><br><span class="line">    <span class="keyword">uint64_t</span> host_features;</span><br><span class="line">â€¦â€¦</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VirtIODevice</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">â€¦â€¦</span><br><span class="line">    <span class="keyword">uint64_t</span> guest_features;</span><br><span class="line">    <span class="keyword">uint64_t</span> host_features;</span><br><span class="line">    <span class="keyword">uint64_t</span> backend_features;</span><br><span class="line">â€¦â€¦</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="VirtIONet-host-features"><a href="#VirtIONet-host-features" class="headerlink" title="VirtIONet::host_features"></a>VirtIONet::host_features</h3><p>ä»virtioè®¾å¤‡çš„è§’åº¦æ¥çœ‹ï¼ŒåªåŒºåˆ†Guestä¸Hostï¼Œå¹¶ä¸å…³å¿ƒHostçš„å…·ä½“å®ç°ã€‚æ‰€ä»¥VirtIONet::host_featuresä»£è¡¨äº†Hostç†è®ºå¯ä»¥æ”¯æŒçš„æ‰€æœ‰featuresã€‚</p>
<p>VirtIONet::host_featuresåœ¨<code>virtio_net_class_init</code>ä¸­ä½¿ç”¨QEMUä¸­virtio-netè®¾å¤‡çš„é»˜è®¤å±æ€§<code>virtio_net_properties</code>ï¼ˆå…¶ä¸­åŒ…å«äº†offloadç›¸å…³çš„featuresï¼‰æ¥åˆå§‹åŒ–ï¼ŒåŒæ—¶åœ¨æ¯ä¸ªvirtio-netè®¾å¤‡å®ä¾‹åŒ–æ—¶ï¼Œä¾æ®åç«¯è®¾å¤‡ï¼ˆe.g. tapï¼‰çš„é…ç½®ï¼Œå¯¹éƒ¨åˆ†featuresè¿›è¡Œè®¾ç½®ã€‚</p>
<p>VirtIONet::host_featureså”¯ä¸€çš„è°ƒç”¨å¤„åœ¨<code>virtio_net_get_features</code>ï¼Œå³å“åº”Guestå‰ç«¯é©±åŠ¨çš„get_featuresè¯·æ±‚ï¼ŒVirtIONet::host_featuresä½œä¸ºåˆå§‹å€¼ï¼Œåœ¨ä¸€ç³»åˆ—çš„è¿‡æ»¤åŠ¨ä½œåï¼Œå‘å‰ç«¯è¿”å›Hostæ‰€æ”¯æŒçš„featuresï¼ˆç»†èŠ‚è§ä¸‹æ–‡ï¼‰ã€‚</p>
<h3 id="VirtIODevice-host-features"><a href="#VirtIODevice-host-features" class="headerlink" title="VirtIODevice::host_features"></a>VirtIODevice::host_features</h3><p>VirtIODevice::host_featuresåœ¨<code>virtio_bus_device_plugged</code>ä¸­è°ƒç”¨å¯¹åº”virtioè®¾å¤‡çš„get_featuresè¿›è¡Œåˆå§‹åŒ–ï¼Œä¿å­˜çš„æ˜¯get_featuresçš„è¿”å›å€¼ï¼Œå³çœŸæ­£è¿”å›ç»™å‰ç«¯é©±åŠ¨çš„featuresã€‚</p>
<p><code>virtio_net_get_features</code>å‘å‰ç«¯è¿”å›featuresçš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>VirtIONet::host_featuresä½œä¸ºåˆå§‹featuresï¼›</li>
<li>å¦‚æœåç«¯è®¾å¤‡ï¼ˆe.g. tapï¼‰ä¸æ”¯æŒvnet_hdrï¼Œåˆ™å°†featuresä¸­å¯¹åº”çš„offload featureså–æ¶ˆç½®ä½ï¼›</li>
<li>QEMUå†…éƒ¨é¢„å®šä¹‰äº†åç«¯æ”¯æŒçš„feature_bitsï¼ˆkernel_feature_bits or user_feature_bitsï¼‰ï¼Œå°†feature_bitsæ”¯æŒä½†vhost_dev::featuresä¸­ä¸æ”¯æŒçš„bitåœ¨featuresä¸­å–æ¶ˆç½®ä½ï¼›</li>
<li>å¯¹<code>VIRTIO_NET_F_MTU</code>è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼ˆå’Œ<code>mtu_bypass_backend</code>æœ‰å…³ï¼Œå¯¹æ•´ä½“åå•†æµç¨‹ä¸é‡è¦ï¼‰ï¼›</li>
<li>å°†ä¸Šè¿°æµç¨‹ä¸­å¤„ç†åçš„featuresè¿”å›ç»™å‰ç«¯é©±åŠ¨ã€‚</li>
</ol>
<p>è¦æ³¨æ„VirtIODevice::host_featureså’ŒVirtIONet::host_featuresçš„åŒºåˆ«ï¼ŒVirtIONet::host_featuresæ˜¯Hostç†è®ºå¯ä»¥æ”¯æŒçš„æ‰€æœ‰featuresï¼Œè€ŒVirtIODevice::host_featuresæ˜¯å¯¹VirtIONet::host_featuresä¸­ä¾æ®åç«¯ã€è®¾å¤‡çš„è®¾ç½®è¿›è¡Œå¤„ç†åï¼ŒçœŸæ­£è¿”å›ç»™å‰ç«¯é©±åŠ¨çš„featuresã€‚</p>
<h3 id="VirtIODevice-guest-features"><a href="#VirtIODevice-guest-features" class="headerlink" title="VirtIODevice::guest_features"></a>VirtIODevice::guest_features</h3><p>Guestå‰ç«¯é©±åŠ¨ç”¨è‡ªèº«featureså’Œget_featureså¾—åˆ°çš„VirtIODevice::host_featuresè¿›è¡Œåå•†åï¼Œä¼ é€’ç»™QEMUï¼Œä¸VirtIODevice::host_featureså–äº¤é›†ï¼Œä¿å­˜å¾—åˆ°guest_featuresã€‚å³å‰åç«¯åœ¨Gueståå•†åå¾—åˆ°çš„featuresã€‚</p>
<h3 id="VirtIODevice-backend-features"><a href="#VirtIODevice-backend-features" class="headerlink" title="VirtIODevice::backend_features"></a>VirtIODevice::backend_features</h3><p>çœ‹ä»£ç è°ƒç”¨æ˜¯ä¸ºäº†ç‰¹æ®Šå¤„ç†<code>mtu_bypass_backend</code>ä¿å­˜çš„ï¼Œåœ¨<code>virtio_net_get_features</code>å¤„ç†æµç¨‹ä¸­ï¼Œç‰¹æ®Šå¤„ç†<code>VIRTIO_NET_F_MTU</code>å‰ä¿å­˜çš„featuresï¼Œé™¤äº†<code>VIRTIO_NET_F_MTU</code>å’ŒVirtIODevice::host_featuresæœ‰å·®å¼‚å¤–ï¼Œå…¶ä»–ä¸€è‡´ã€‚</p>
<h2 id="QEMUæ­£å¸¸å¯åŠ¨æµç¨‹ä¸­çš„featuresåå•†"><a href="#QEMUæ­£å¸¸å¯åŠ¨æµç¨‹ä¸­çš„featuresåå•†" class="headerlink" title="QEMUæ­£å¸¸å¯åŠ¨æµç¨‹ä¸­çš„featuresåå•†"></a>QEMUæ­£å¸¸å¯åŠ¨æµç¨‹ä¸­çš„featuresåå•†</h2><p>QEMUæ­£å¸¸å¯åŠ¨æµç¨‹ä¸­ï¼Œä»å¼€å§‹è¿è¡Œåˆ°GuestOSå¯åŠ¨çš„RunStateçš„å˜åŒ–ï¼š<code>preconfig</code>-&gt;<code>prelaunch</code>-&gt;<code>running</code>ã€‚</p>
<p>ä¸Šè¿°RunStateå˜åŒ–è¿‡ç¨‹ä¸­ï¼Œvirtioè®¾å¤‡çš„featuresç›¸å…³æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>preconfig: <code>qemu_init</code>-&gt;<code>net_init_clients</code>-&gt;â€¦â€¦-&gt;<code>net_init_tap</code>-&gt;â€¦â€¦-&gt;<code>vhost_net_init</code>ï¼Œåˆå§‹åŒ–tapå’Œvhost_devã€‚å…¶ä¸­vhost_devåˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨åç«¯å¯¹åº”çš„æ¥å£ï¼Œè·å–åç«¯æ”¯æŒçš„æ‰€æœ‰featuresï¼Œç”¨æ¥åˆå§‹åŒ–<code>vhost_dev::features</code>ï¼ŒåŒæ—¶ä¾æ®å¯¹ç«¯è®¾å¤‡ï¼ˆtapï¼‰æ”¯æŒçš„ç‰¹æ€§ï¼Œåˆå§‹åŒ–<code>vhost_dev::backend_features</code>ï¼Œä»¥åŠåˆå§‹åŒ–<code>vhost_dev::protocol_features</code>ä¸º0ï¼›</li>
<li>prelaunch: è°ƒç”¨<code>virtio_bus_device_plugged</code>ï¼Œé€šè¿‡å¯¹åº”è®¾å¤‡ç±»å‹çš„get_featuresï¼Œåˆå§‹åŒ–<code>VirtIODevice::host_features</code>ï¼›</li>
<li>running: <ul>
<li>GuestOSå¯åŠ¨ï¼Œå†…éƒ¨virtio_neté©±åŠ¨è¢«åŠ è½½ï¼Œè°ƒç”¨<code>virtio_dev_probe</code>-&gt;â€¦â€¦-&gt;<code>vp_get_features</code>è·å–è®¾å¤‡çš„featuresï¼Œå³QEMUä¾§çš„<code>VirtIODevice::host_features</code>ï¼Œå†ä¸è‡ªèº«é©±åŠ¨æ”¯æŒçš„featuresè¿›è¡Œåå•†ï¼Œåå•†å®Œæˆåè°ƒç”¨<code>virtio_finalize_features</code>-&gt;â€¦â€¦-&gt;<code>vp_set_features</code>å°†åå•†å¥½çš„featuresä¼ ç»™QEMUï¼›</li>
<li>æ­¤æ—¶å‘ç”ŸVM-EXITï¼ŒQEMUä¾§è°ƒç”¨<code>virtio_set_features</code>-&gt;â€¦â€¦-&gt;<code>virtio_net_set_features</code>-&gt;â€¦â€¦-&gt;<code>vhost_ack_features</code>ï¼ŒæŠŠå‰ç«¯é©±åŠ¨ä¼ é€’è¿‡æ¥çš„featureså’Œåç«¯å¯¹åº”feature_bitså…±åŒæ”¯æŒçš„bitç½®ä½ï¼Œå°†ç»“æœä¿å­˜åœ¨<code>vhost_dev::acked_features</code>ï¼›</li>
<li>GuestOSä¸­<code>virtio_finalize_features</code>-&gt;â€¦â€¦-&gt;<code>vp_set_features</code>æ‰§è¡Œå®Œæˆåï¼Œä¼šè®¾ç½®<code>VIRTIO_CONFIG_S_FEATURES_OK</code>ï¼Œè¿›è€Œè§¦å‘QEMUä¾§çš„å¯¹åº”è°ƒç”¨<code>virtio_set_status</code>-&gt;â€¦â€¦-&gt;<code>vhost_dev_start</code>ã€‚åœ¨<code>vhost_dev_start</code>ä¸­ï¼Œè°ƒç”¨<code>vhost_dev_set_features</code>ï¼Œå°†å‰ç«¯åå•†å¥½çš„<code>vhost_dev::acked_features</code>é€šè¿‡åç«¯å¯¹åº”çš„æ¥å£ä¼ é€’åˆ°åç«¯ã€‚</li>
</ul>
</li>
</ol>
<h2 id="QEMUçƒ­è¿ç§»æµç¨‹ä¸­çš„featuresåå•†"><a href="#QEMUçƒ­è¿ç§»æµç¨‹ä¸­çš„featuresåå•†" class="headerlink" title="QEMUçƒ­è¿ç§»æµç¨‹ä¸­çš„featuresåå•†"></a>QEMUçƒ­è¿ç§»æµç¨‹ä¸­çš„featuresåå•†</h2><p>QEMUçƒ­è¿ç§»æµç¨‹ä¸­ï¼Œæºè™šæ‹Ÿæœºä»å¼€å§‹è¿è¡Œåˆ°è¿ç§»ç»“æŸçš„RunStateå˜åŒ–ï¼š<code>running</code>-&gt;<code>finish_migrate</code>-&gt;<code>postmigrate</code>ï¼›ç›®çš„è™šæ‹Ÿæœºä»å¼€å§‹è¿è¡Œåˆ°GuestOSå¯åŠ¨çš„RunStateçš„å˜åŒ–ï¼š<code>preconfig</code>-&gt;<code>inmigrate</code>-&gt;<code>running</code>ã€‚</p>
<h3 id="æºç«¯virtio-featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–"><a href="#æºç«¯virtio-featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–" class="headerlink" title="æºç«¯virtio featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–"></a>æºç«¯virtio featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–</h3><ol>
<li>running: æ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œæ— ç›¸å…³æ“ä½œï¼›</li>
<li>finish_migrate: <code>virtio_save</code>ä¸­ä¿å­˜<code>VirtIODevice::guest_features</code>çš„ä½32bitï¼Œè¿ç§»åˆ°ç›®çš„ç«¯ã€‚</li>
</ol>
<h3 id="ç›®çš„ç«¯virtio-featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–"><a href="#ç›®çš„ç«¯virtio-featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–" class="headerlink" title="ç›®çš„ç«¯virtio featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–"></a>ç›®çš„ç«¯virtio featuresåœ¨çƒ­è¿ç§»æµç¨‹ä¸­çš„å˜åŒ–</h3><ol>
<li>preconfig: å’Œæ­£å¸¸å¯åŠ¨æµç¨‹ä¸€è‡´ï¼›</li>
<li>inmigrate: <ul>
<li>è°ƒç”¨<code>virtio_bus_device_plugged</code>ï¼Œé€šè¿‡å¯¹åº”è®¾å¤‡ç±»å‹çš„get_featuresï¼Œåˆå§‹åŒ–<code>VirtIODevice::host_features</code>ï¼›</li>
<li><code>virtio_load</code>-&gt;â€¦â€¦-&gt;<code>virtio_net_set_features</code>-&gt;â€¦â€¦-&gt;<code>vhost_ack_features</code>ï¼Œåœ¨<code>virtio_load</code>ä¸­æ¥æ”¶æºç«¯åå•†å®Œæˆçš„<code>VirtIODevice::guest_features</code>ï¼Œåœ¨<code>vhost_ack_features</code>ä¸­å°†æ¥æ”¶åˆ°çš„<code>VirtIODevice::guest_features</code>å’Œåç«¯å¯¹åº”feature_bitså…±åŒæ”¯æŒçš„bitç½®ä½ï¼Œå°†ç»“æœä¿å­˜åœ¨<code>vhost_dev::acked_features</code>ï¼›</li>
</ul>
</li>
<li>running: <code>qemu_main_loop</code>-&gt;<code>main_loop_wait</code>-&gt;â€¦â€¦-&gt;<code>vm_start</code>-&gt;â€¦â€¦-&gt;<code>virtio_set_features</code>ï¼Œä½¿ç”¨inmigrateè¿‡ç¨‹ä¸­è®¾ç½®å¥½çš„<code>vhost_net::acked_features</code>é€šè¿‡åç«¯å¯¹åº”çš„æ¥å£ä¼ é€’åˆ°åç«¯ã€‚</li>
</ol>
<h2 id="æ­£å¸¸å¯åŠ¨æµç¨‹å’Œçƒ­è¿ç§»æµç¨‹å¯¹æ¯”"><a href="#æ­£å¸¸å¯åŠ¨æµç¨‹å’Œçƒ­è¿ç§»æµç¨‹å¯¹æ¯”" class="headerlink" title="æ­£å¸¸å¯åŠ¨æµç¨‹å’Œçƒ­è¿ç§»æµç¨‹å¯¹æ¯”"></a>æ­£å¸¸å¯åŠ¨æµç¨‹å’Œçƒ­è¿ç§»æµç¨‹å¯¹æ¯”</h2><p>ç¡¬ä»¶è®¾å¤‡çš„åˆå§‹åŒ–æµç¨‹éƒ½ä¸€è‡´ï¼Œé™¤äº†PCIè®¾å¤‡çš„ä¸€äº›çŠ¶æ€ä¹Ÿæ˜¯é€šè¿‡è¿ç§»åˆå§‹åŒ–ä¹‹å¤–ï¼Œæœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºçƒ­è¿ç§»æµç¨‹ä¸­çš„featuresåå•†è¿‡ç¨‹ï¼šåå•†å¿…é¡»çš„<code>VirtIODevice::guest_features</code>é€šè¿‡çƒ­è¿ç§»ä»æºç«¯è·å–ï¼Œåç«¯ç›´æ¥å’ŒQEMUè¿›è¡Œåå•†æµç¨‹ï¼›åå•†æµç¨‹æ§åˆ¶ä¸å†éœ€è¦å‰ç«¯é©±åŠ¨ä¿®æ”¹è®¾å¤‡statusï¼Œè€Œæ˜¯åœ¨QEMUçƒ­è¿ç§»æµç¨‹ä¸­è§¦å‘ã€‚å‰ç«¯é©±åŠ¨ä¸å‚ä¸ã€ä¸æ„ŸçŸ¥ï¼Œé¿å…äº†é‡æ–°åˆå§‹åŒ–ã€‚</p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>Virtualization</tag>
        <tag>Virtio/Vhost</tag>
      </tags>
  </entry>
</search>
